{%- for access_control in access_control_configuration %}
data "clumio_role" "role_{{ access_control.role_name | replace(' ', '_') | lower }}" {
  {%- if clumio_provider_alias %}
  provider = clumio.{{ clumio_provider_alias }}
  {%- endif %}
  name     = "{{ access_control.role_name }}"
}
{% endfor %}
resource "clumio_user" "{{ user_name }}" {
  {%- if clumio_provider_alias %}
  provider    = clumio.{{ clumio_provider_alias }}
  {%- endif %}
  email       = "{{ email }}"
  full_name   = "{{ full_name }}"
  access_control_configuration = [ 
  {%- for access_control in access_control_configuration %}
    {
      role_id = data.clumio_role.role_{{ access_control.role_name | replace(' ', '_') | lower }}.id
      organizational_unit_ids = {{ access_control.organizational_unit_ids | tojson }}
    }{% if not loop.last %},{% endif %}
  {%- endfor %}
  ]
}
